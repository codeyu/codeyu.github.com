<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>【Akka.NET 文档】Actor 系统 | CodeYu</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/4.1.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.2/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/2.2.3/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">【Akka.NET 文档】Actor 系统</h1><a id="logo" href="/.">CodeYu</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">【Akka.NET 文档】Actor 系统</h1><div class="post-meta">Oct 22, 2016<span> | </span><span class="category"><a href="/categories/翻译/">翻译</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><div class="post-content"><a id="more"></a>
<p><a href="actors">Actors</a> are objects which encapsulate state and behavior, they communicate exclusively by exchanging <a href="messages">messages</a> which are placed into the recipient's mailbox. In a sense, actors are the most stringent form of object-oriented programming, but it serves better to view them as persons: while modeling a solution with actors, envision a group of people and assign sub-tasks to them, arrange their functions into an organizational structure and think about how to escalate failure (all with the benefit of not actually dealing with people, which means that we need not concern ourselves with their emotional state or moral issues). The result can then serve as a mental scaffolding for building the software implementation.</p>
<blockquote>
<p><strong>Note</strong><br>
An <code>ActorSystem</code> is a heavyweight structure that will allocate 1...N Threads, so create one per logical application.</p>
</blockquote>
<h2 id="hierarchical-structure"><a class="header-anchor" href="#hierarchical-structure">¶</a>Hierarchical Structure</h2>
<p>Like in an economic organization, actors naturally form hierarchies. One actor, which is to oversee a certain function in the program might want to split up its task into smaller, more manageable pieces. For this purpose it starts child actors which it supervises. While the details of supervision are explained here, we shall concentrate on the underlying concepts in this section. The only prerequisite is to know that each actor has exactly one supervisor, which is the actor that created it.</p>
<p>The quintessential feature of actor systems is that tasks are split up and delegated until they become small enough to be handled in one piece. In doing so, not only is the task itself clearly structured, but the resulting actors can be reasoned about in terms of which messages they should process, how they should react normally and how failure should be handled. If one actor does not have the means for dealing with a certain situation, it sends a corresponding failure message to its supervisor, asking for help. The recursive structure then allows to handle failure at the right level.</p>
<p><img src="http://oj3pzn0i5.bkt.clouddn.com/ErrorKernel.png" alt="ActorSystem hierarchy, illustrated using error kernel pattern"></p>
<p>Compare this to layered software design which easily devolves into defensive programming with the aim of not leaking any failure out: if the problem is communicated to the right person, a better solution can be found than if trying to keep everything “under the carpet”.</p>
<p>Now, the difficulty in designing such a system is how to decide who should supervise what. There is of course no single best solution, but there are a few guidelines which might be helpful:</p>
<ul>
<li>If one actor manages the work another actor is doing, e.g. by passing on sub-tasks, then the manager should supervise the child. The reason is that the manager knows which kind of failures are expected and how to handle them.</li>
<li>If one actor carries very important data (i.e. its state shall not be lost if avoidable), this actor should source out any possibly dangerous sub-tasks to children it supervises and handle failures of these children as appropriate. Depending on the nature of the requests, it may be best to create a new child for each request, which simplifies state management for collecting the replies. This is known as the “Error Kernel Pattern” from Erlang.</li>
<li>If one actor depends on another actor for carrying out its duty, it should watch that other actor's liveness and act upon receiving a termination notice. This is different from supervision, as the watching party has no influence on the supervisor strategy, and it should be noted that a functional dependency alone is not a criterion for deciding where to place a certain child actor in the hierarchy.
There are of course always exceptions to these rules, but no matter whether you follow the rules or break them, you should always have a reason.</li>
</ul>
<h2 id="configuration-container"><a class="header-anchor" href="#configuration-container">¶</a>Configuration Container</h2>
<p>The actor system as a collaborating ensemble of actors is the natural unit for managing shared facilities like scheduling services, configuration, logging, etc. Several actor systems with different configuration may co-exist within the same runtime without problems, there is no global shared state within Akka.NET itself. Couple this with the transparent communication between actor systems—within one node or across a network connection—to see that actor systems themselves can be used as building blocks in a functional hierarchy.</p>
<h2 id="actor-best-practices"><a class="header-anchor" href="#actor-best-practices">¶</a>Actor Best Practices</h2>
<ol>
<li>Actors should be like nice co-workers: do their job efficiently without bothering everyone else needlessly and avoid hogging resources. Translated to programming this means to process events and generate responses (or more requests) in an event-driven manner. Actors should not block (i.e. passively wait while occupying a Thread) on some external entity—which might be a lock, a network socket, etc.—unless it is unavoidable; in the latter case see below.</li>
<li>Do not pass mutable objects between actors. In order to ensure that, prefer immutable messages. If the encapsulation of actors is broken by exposing their mutable state to the outside, you are back in normal .NET concurrency land with all the drawbacks.</li>
<li>Actors are made to be containers for behavior and state, embracing this means to not routinely send behavior within messages. One of the risks is to accidentally share mutable state between actors, and this violation of the actor model unfortunately breaks all the properties which make programming in actors such a nice experience.</li>
<li>Top-level actors are the innermost part of your Error Kernel, so create them sparingly and prefer truly hierarchical systems. This has benefits with respect to fault-handling (both considering the granularity of configuration and the performance) and it also reduces the strain on the guardian actor, which is a single point of contention if over-used.</li>
</ol>
<h2 id="blocking-needs-careful-management"><a class="header-anchor" href="#blocking-needs-careful-management">¶</a>Blocking Needs Careful Management</h2>
<p>In some cases it is unavoidable to do blocking operations, i.e. to put a thread to sleep for an indeterminate time, waiting for an external event to occur. Examples are legacy RDBMS drivers or messaging APIs, and the underlying reason is typically that (network) I/O occurs under the covers. When facing this, you may be tempted to just wrap the blocking call inside a Future and work with that instead, but this strategy is too simple: you are quite likely to find bottlenecks or run out of memory or threads when the application runs under increased load.</p>
<p>The non-exhaustive list of adequate solutions to the “blocking problem” includes the following suggestions:</p>
<ul>
<li>Do the blocking call within an actor (or a set of actors managed by a <a href="Routing">router</a>), making sure to configure a thread pool which is either dedicated for this purpose or sufficiently sized.</li>
<li>Do the blocking call within a Future, ensuring an upper bound on the number of such calls at any point in time (submitting an unbounded number of tasks of this nature will exhaust your memory or thread limits).</li>
<li>Do the blocking call within a Future, providing a thread pool with an upper limit on the number of threads which is appropriate for the hardware on which the application runs.</li>
<li>Dedicate a single thread to manage a set of blocking resources (e.g. a NIO selector driving multiple channels) and dispatch events as they occur as actor messages.</li>
</ul>
<p>The first possibility is especially well-suited for resources which are single-threaded in nature, like database handles which traditionally can only execute one outstanding query at a time and use internal synchronization to ensure this. A common pattern is to create a router for N actors, each of which wraps a single DB connection and handles queries as sent to the router. The number N must then be tuned for maximum throughput, which will vary depending on which DBMS is deployed on what hardware.</p>
<blockquote>
<p><strong>Note</strong><br>
Configuring thread pools is a task best delegated to Akka, simply configure in the application.conf and instantiate through an ActorSystem.</p>
</blockquote>
<h2 id="what-you-should-not-concern-yourself-with"><a class="header-anchor" href="#what-you-should-not-concern-yourself-with">¶</a>What you should not concern yourself with</h2>
<p>An actor system manages the resources it is configured to use in order to run the actors which it contains. There may be millions of actors within one such system, after all the mantra is to view them as abundant and they weigh in at an overhead of only roughly 300 bytes per instance. Naturally, the exact order in which messages are processed in large systems is not controllable by the application author, but this is also not intended. Take a step back and relax while Akka.NET does the heavy lifting under the hood.</p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://codeyu.com/2016/10/22/actorsystem/" data-id="cjiswvz6p000owu5ask07cjua" class="article-share-link">分享到</a><div class="tags"><a href="/tags/Akka-NET/">Akka.NET</a></div><div class="post-nav"><a href="/2016/10/22/actors/" class="pre">【Akka.NET 文档】Actors</a><a href="/2016/09/22/linux-zsh-shell-script-command-not-found/" class="next">linux zsh 使用 sudo 执行 bash 脚本提示 command not found</a></div><div id="lv-container" data-id="city" data-uid="MTAyMC8zNTY1OC8xMjE5NA=="><script>(function(d, s) {
 var j, e = d.getElementsByTagName(s)[0];

 if (typeof LivereTower === 'function') { return; }

 j = d.createElement(s);
 j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
 j.async = true;

 e.parentNode.insertBefore(j, e);
})(document, 'script');</script><noscript>为正常使用来必力评论功能请激活JavaScript</noscript></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://codeyu.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/其他/">其他</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/技术/">技术</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/翻译/">翻译</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/linux/" style="font-size: 15px;">linux</a> <a href="/tags/计划/" style="font-size: 15px;">计划</a> <a href="/tags/学习/" style="font-size: 15px;">学习</a> <a href="/tags/Akka-NET/" style="font-size: 15px;">Akka.NET</a> <a href="/tags/chrome/" style="font-size: 15px;">chrome</a> <a href="/tags/node-js/" style="font-size: 15px;">node.js</a> <a href="/tags/test/" style="font-size: 15px;">test</a> <a href="/tags/docker/" style="font-size: 15px;">docker</a> <a href="/tags/windows/" style="font-size: 15px;">windows</a> <a href="/tags/奋斗/" style="font-size: 15px;">奋斗</a> <a href="/tags/ubuntu/" style="font-size: 15px;">ubuntu</a> <a href="/tags/java/" style="font-size: 15px;">java</a> <a href="/tags/how-to/" style="font-size: 15px;">how-to</a> <a href="/tags/bash/" style="font-size: 15px;">bash</a> <a href="/tags/python/" style="font-size: 15px;">python</a> <a href="/tags/机器学习/" style="font-size: 15px;">机器学习</a> <a href="/tags/scikit-learn/" style="font-size: 15px;">scikit-learn</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/04/12/run-sudo-command-without-password-linux/">如何实现 ssh 无密码登录</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/29/install-java-8-on-centos-rhel-and-fedora/">在 CentOS/RHEL 7/6 和 Fedora 26/25 系统里如何安装 Java 8</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/29/Welcome-to-StackEdit/">Welcome to StackEdit!</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/18/automated-testing-with-headless-chrome/">用 Headless Chrome 进行测试自动化</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/17/how-find-a-port-and-kill-it/">如何查找端口占用及杀掉进程</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/13/docker-cheat-sheet/">docker 命令速查表</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/31/2017-first-Post/">2017，我的第一本英文原版书</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/22/actors/">【Akka.NET 文档】Actors</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/22/actorsystem/">【Akka.NET 文档】Actor 系统</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/22/linux-zsh-shell-script-command-not-found/">linux zsh 使用 sudo 执行 bash 脚本提示 command not found</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.cnblogs.com/codeyu" title="codeyu@cnblogs.com" target="_blank">codeyu@cnblogs.com</a><ul></ul><a href="https://www.haomwei.com" title="屠城" target="_blank">屠城</a><ul></ul><a href="http://blog.guqiankun.com" title="技术掘金" target="_blank">技术掘金</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">CodeYu.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>