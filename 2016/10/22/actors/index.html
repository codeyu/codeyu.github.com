<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>【Akka.NET 文档】Actors | CodeYu</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/4.1.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.2/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/2.2.3/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">【Akka.NET 文档】Actors</h1><a id="logo" href="/.">CodeYu</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">【Akka.NET 文档】Actors</h1><div class="post-meta">Oct 22, 2016<span> | </span><span class="category"><a href="/categories/翻译/">翻译</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><div class="post-content"><a id="more"></a>
<p>The previous section about <a href="actorsystems">Actor Systems</a> explained how actors form hierarchies and are the smallest unit when building an application. This section looks at one such actor in isolation, explaining the concepts you encounter while implementing it. For a more in depth reference with all the details please refer to F# API or C# API.</p>
<p>An actor is a container for <a href="#state">State</a>, <a href="#behavior">Behavior</a>, a <a href="#mailbox">Mailbox</a>, <a href="#children">Children</a> and a <a href="#supervisor-strategy">Supervisor Strategy</a>. All of this is encapsulated behind an Actor Reference(<code>ActorRef</code>).</p>
<p><img src="http://oj3pzn0i5.bkt.clouddn.com/actor.png" alt="Actor"></p>
<h2 id="actor-reference"><a class="header-anchor" href="#actor-reference">¶</a>Actor Reference</h2>
<p>As detailed below, an actor object needs to be shielded from the outside in order to benefit from the actor model. Therefore, actors are represented to the outside using actor references, which are objects that can be passed around freely and without restriction. This split into inner and outer object enables transparency for all the desired operations: restarting an actor without needing to update references elsewhere, placing the actual actor object on remote hosts, sending messages to actors in completely different applications. But the most important aspect is that it is not possible to look inside an actor and get hold of its state from the outside, unless the actor unwisely publishes this information itself.</p>
<h2 id="state"><a class="header-anchor" href="#state">¶</a>State</h2>
<p>Actor objects will typically contain some variables which reflect possible states the actor may be in. This can be an explicit state machine (e.g. using the FSM module), or it could be a counter, set of listeners, pending requests, etc. These data are what make an actor valuable, and they must be protected from corruption by other actors. The good news is that Akka.NET actors conceptually each have their own light-weight thread, which is completely shielded from the rest of the system. This means that instead of having to synchronize access using locks you can just write your actor code without worrying about concurrency at all.</p>
<p>Behind the scenes Akka.NET will run sets of actors on sets of real threads, where typically many actors share one thread, and subsequent invocations of one actor may end up being processed on different threads. Akka.NET ensures that this implementation detail does not affect the single-threadedness of handling the actor's state.</p>
<p>Because the internal state is vital to an actor's operations, having inconsistent state is fatal. Thus, when the actor fails and is restarted by its supervisor, the state will be created from scratch, like upon first creating the actor. This is to enable the ability of self-healing of the system.</p>
<p>Optionally, an actor's state can be automatically recovered to the state before a restart by persisting received messages and replaying them after restart (see Persistence).</p>
<h2 id="behavior"><a class="header-anchor" href="#behavior">¶</a>Behavior</h2>
<p>Every time a message is processed, it is matched against the current behavior of the actor. Behavior means a function which defines the actions to be taken in reaction to the message at that point in time, say forward a request if the client is authorized, deny it otherwise. This behavior may change over time, e.g. because different clients obtain authorization over time, or because the actor may go into an “out-of-service” mode and later come back. These changes are achieved by either encoding them in state variables which are read from the behavior logic, or the function itself may be swapped out at runtime, see the become and unbecome operations. However, the initial behavior defined during construction of the actor object is special in the sense that a restart of the actor will reset its behavior to this initial one.</p>
<h2 id="mailbox"><a class="header-anchor" href="#mailbox">¶</a>Mailbox</h2>
<p>An actor's purpose is the processing of messages, and these messages were sent to the actor from other actors (or from outside the actor system). The piece which connects sender and receiver is the actor's mailbox: each actor has exactly one mailbox to which all senders enqueue their messages. Enqueuing happens in the time-order of send operations, which means that messages sent from different actors may not have a defined order at runtime due to the apparent randomness of distributing actors across threads. Sending multiple messages to the same target from the same actor, on the other hand, will enqueue them in the same order.</p>
<p>There are different mailbox implementations to choose from, the default being a FIFO: the order of the messages processed by the actor matches the order in which they were enqueued. This is usually a good default, but applications may need to prioritize some messages over others. In this case, a priority mailbox will enqueue not always at the end but at a position as given by the message priority, which might even be at the front. While using such a queue, the order of messages processed will naturally be defined by the queue's algorithm and in general not be FIFO.</p>
<p>An important feature in which Akka.NET differs from some other actor model implementations is that the current behavior must always handle the next dequeued message, there is no scanning the mailbox for the next matching one. Failure to handle a message will typically be treated as a failure, unless this behavior is overridden.</p>
<h2 id="children"><a class="header-anchor" href="#children">¶</a>Children</h2>
<p>Each actor is potentially a supervisor: if it creates children for delegating sub-tasks, it will automatically supervise them. The list of children is maintained within the actor's context and the actor has access to it. Modifications to the list are done by creating (<code>Context.ActorOf(...)</code>) or stopping (<code>Context.Stop(child)</code>) children and these actions are reflected immediately. The actual creation and termination actions happen behind the scenes in an asynchronous way, so they do not “block” their supervisor.</p>
<h2 id="supervisor-strategy"><a class="header-anchor" href="#supervisor-strategy">¶</a>Supervisor Strategy</h2>
<p>The final piece of an actor is its strategy for handling faults of its children. Fault handling is then done transparently by Akka, applying one of the strategies described in Supervision and Monitoring for each incoming failure. As this strategy is fundamental to how an actor system is structured, it cannot be changed once an actor has been created.</p>
<p>Considering that there is only one such strategy for each actor, this means that if different strategies apply to the various children of an actor, the children should be grouped beneath intermediate supervisors with matching strategies, preferring once more the structuring of actor systems according to the splitting of tasks into sub-tasks.</p>
<h2 id="when-an-actor-terminates"><a class="header-anchor" href="#when-an-actor-terminates">¶</a>When an Actor Terminates</h2>
<p>Once an actor terminates, i.e. fails in a way which is not handled by a restart, stops itself or is stopped by its supervisor, it will free up its resources, draining all remaining messages from its mailbox into the system's “dead letter mailbox” which will forward them to the <code>EventStream</code> as <code>DeadLetters</code>. The mailbox is then replaced within the actor reference with a system mailbox, redirecting all new messages to the <code>EventStream</code> as <code>DeadLetters</code>. This is done on a best effort basis, though, so do not rely on it in order to construct “guaranteed delivery”.</p>
<p>The reason for not just silently dumping the messages was inspired by our tests: we register the TestEventListener on the event bus to which the dead letters are forwarded, and that will log a warning for every dead letter received—this has been very helpful for deciphering test failures more quickly. It is conceivable that this feature may also be of use for other purposes.</p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://codeyu.com/2016/10/22/actors/" data-id="cjiswvz6k000lwu5ae39f1fi3" class="article-share-link">分享到</a><div class="tags"><a href="/tags/Akka-NET/">Akka.NET</a></div><div class="post-nav"><a href="/2016/12/31/2017-first-Post/" class="pre">2017，我的第一本英文原版书</a><a href="/2016/10/22/actorsystem/" class="next">【Akka.NET 文档】Actor 系统</a></div><div id="lv-container" data-id="city" data-uid="MTAyMC8zNTY1OC8xMjE5NA=="><script>(function(d, s) {
 var j, e = d.getElementsByTagName(s)[0];

 if (typeof LivereTower === 'function') { return; }

 j = d.createElement(s);
 j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
 j.async = true;

 e.parentNode.insertBefore(j, e);
})(document, 'script');</script><noscript>为正常使用来必力评论功能请激活JavaScript</noscript></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://codeyu.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/其他/">其他</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/技术/">技术</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/翻译/">翻译</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/linux/" style="font-size: 15px;">linux</a> <a href="/tags/计划/" style="font-size: 15px;">计划</a> <a href="/tags/学习/" style="font-size: 15px;">学习</a> <a href="/tags/Akka-NET/" style="font-size: 15px;">Akka.NET</a> <a href="/tags/chrome/" style="font-size: 15px;">chrome</a> <a href="/tags/node-js/" style="font-size: 15px;">node.js</a> <a href="/tags/test/" style="font-size: 15px;">test</a> <a href="/tags/docker/" style="font-size: 15px;">docker</a> <a href="/tags/windows/" style="font-size: 15px;">windows</a> <a href="/tags/奋斗/" style="font-size: 15px;">奋斗</a> <a href="/tags/ubuntu/" style="font-size: 15px;">ubuntu</a> <a href="/tags/java/" style="font-size: 15px;">java</a> <a href="/tags/how-to/" style="font-size: 15px;">how-to</a> <a href="/tags/bash/" style="font-size: 15px;">bash</a> <a href="/tags/python/" style="font-size: 15px;">python</a> <a href="/tags/机器学习/" style="font-size: 15px;">机器学习</a> <a href="/tags/scikit-learn/" style="font-size: 15px;">scikit-learn</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/04/12/run-sudo-command-without-password-linux/">如何实现 ssh 无密码登录</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/29/install-java-8-on-centos-rhel-and-fedora/">在 CentOS/RHEL 7/6 和 Fedora 26/25 系统里如何安装 Java 8</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/29/Welcome-to-StackEdit/">Welcome to StackEdit!</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/18/automated-testing-with-headless-chrome/">用 Headless Chrome 进行测试自动化</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/17/how-find-a-port-and-kill-it/">如何查找端口占用及杀掉进程</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/13/docker-cheat-sheet/">docker 命令速查表</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/31/2017-first-Post/">2017，我的第一本英文原版书</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/22/actors/">【Akka.NET 文档】Actors</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/22/actorsystem/">【Akka.NET 文档】Actor 系统</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/22/linux-zsh-shell-script-command-not-found/">linux zsh 使用 sudo 执行 bash 脚本提示 command not found</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.cnblogs.com/codeyu" title="codeyu@cnblogs.com" target="_blank">codeyu@cnblogs.com</a><ul></ul><a href="https://www.haomwei.com" title="屠城" target="_blank">屠城</a><ul></ul><a href="http://blog.guqiankun.com" title="技术掘金" target="_blank">技术掘金</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">CodeYu.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>